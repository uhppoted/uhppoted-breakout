package bisync

import (
	"testing"
)

func TestCRC16(t *testing.T) {
	header := []uint8{}
	content := []uint8{
		0x30, 0x2e, 0x02, 0x01, 0x00, 0x04, 0x06, 0x70,
		0x75, 0x62, 0x6c, 0x69, 0x63, 0xa2, 0x21, 0x02,
		0x03, 0x0c, 0x78, 0x54, 0x02, 0x01, 0x00, 0x02,
		0x01, 0x00, 0x30, 0x14, 0x30, 0x12, 0x06, 0x0a,
		0x2b, 0x06, 0x01, 0x04, 0x01, 0x84, 0x80, 0x00,
		0x01, 0x01, 0x02, 0x04, 0x18, 0x2a, 0x37, 0x78,
	}

	expected := uint16(0xec70)

	CRC := uint16(0xffff)
	CRC = CRC16(CRC, header)
	CRC = CRC16(CRC, []uint8{2})
	CRC = CRC16(CRC, content)
	CRC = CRC16(CRC, []uint8{3})

	if CRC != expected {
		t.Errorf("invalid CRC - expected:%04x, got:%04x", expected, CRC)
	}
}
